<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>TERMINAL KRYZYSOWY</title>

<style>
body {
  background: black;
  color: #00ff66;
  font-family: monospace;
  padding: 20px;
}

#terminal {
  white-space: pre-wrap;
  line-height: 1.4;
}

.input-line {
  display: flex;
  align-items: center;
}

#userInput {
  background: black;
  color: red;
  border: none;
  outline: none;
  font-family: monospace;
  font-size: 1.4em;
  width: auto;
}

.cursor {
  color: red;
  margin-left: 4px;
  animation: blink 1s steps(2, start) infinite;
}

@keyframes blink {
  to {
    visibility: hidden;
  }
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>

<div id="terminal"></div>

<div class="input-line">
  <input id="userInput" autofocus autocomplete="off">
  <span class="cursor">â–ˆ</span>
</div>

<script>
// ðŸ” FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyB_llniMN_IdBgfPt19uJnxKH807b-5XB0",
  authDomain: "terminal-kryzysowy.firebaseapp.com",
  databaseURL: "https://terminal-kryzysowy-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "terminal-kryzysowy",
  storageBucket: "terminal-kryzysowy.firebasestorage.app",
  messagingSenderId: "375191258633",
  appId: "1:375191258633:web:902b38af58abdb2a629ad8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ§  ETAPY
const steps = [
  { text: "TERMINAL KRYZYSOWY\nLokalizacja: Osiedla BoÅ„czyk\nWpisz autoryzowanÄ… nazwÄ™ uÅ¼ytkownika:", answer: "OPERATOR" },
  { text: "\nRozpoczÄ™to proces zarzÄ…dzania kryzysowego.\nProszÄ™ wpisaÄ‡ ID strefy:", answer: "A" },
  { text: "\nWybrano strefÄ™ A.\nProszÄ™ wpisaÄ‡ hasÅ‚o aktywacyjne do zabezpieczenia strefy A:", answer: "ALFA32" },
  { text: "\nStrefa A zabezpieczona.\nProszÄ™ wpisaÄ‡ ID kolejnej strefy:", answer: "B" },
  { text: "\nWybrano strefÄ™ B.\nProszÄ™ wpisaÄ‡ hasÅ‚o aktywacyjne do zabezpieczenia strefy B:", answer: "BRAVO" },
  { text: "\nStrefa B zabezpieczona.\nProszÄ™ wpisaÄ‡ ID kolejnej strefy:", answer: "C" },
  { text: "\nWybrano strefÄ™ C.\nProszÄ™ wpisaÄ‡ hasÅ‚o aktywacyjne do zabezpieczenia strefy C:", answer: "CHARLIE" },
  { text: "\nStrefa C zabezpieczona.\nProszÄ™ wpisaÄ‡ ID schronu:", answer: "51H" },
  { text: "\nWybrano schron 51H.\nProszÄ™ wpisaÄ‡ hasÅ‚o aktywacyjne do zabezpieczenia schronu 51H:", answer: "OMEGA" }
];

let currentStep = 0;
let failedAttempts = 0;
let locked = false;

const terminal = document.getElementById("terminal");
const input = document.getElementById("userInput");

function log(text) {
  terminal.innerText += text + "\n";
  terminal.scrollTop = terminal.scrollHeight;
}

function updateFirebase(status) {
  db.ref("game").set({
    step: currentStep,
    status: status,
    timestamp: new Date().toLocaleTimeString()
  });
}

// START
log(steps[0].text);
updateFirebase("START");

input.addEventListener("keydown", function(e) {
  if (e.key === "Enter" && !locked) {
    const value = input.value.toUpperCase();
    log("\n> " + value);
    input.value = "";

    if (value === steps[currentStep].answer) {
      failedAttempts = 0;
      currentStep++;
      updateFirebase("STEP " + currentStep);

      if (currentStep < steps.length) {
        log(steps[currentStep].text);
      } else {
        log("\nSCHRON 51H ZABEZPIECZONY.");
        log("\nKOD DO UJAWNIENIA PAKIETU:");
        log("XYZ");
        updateFirebase("FINISH");
        input.disabled = true;
      }
    } else {
      failedAttempts++;
      log("\nBÅÄ„D AUTORYZACJI.");

      if (failedAttempts >= 3) {
        locked = true;
        log("\nZBYT WIELE NIEUDANYCH PRÃ“B.");
        log("TERMINAL ZABLOKOWANY NA 30 SEKUND.");
        updateFirebase("LOCKED");

        setTimeout(() => {
          locked = false;
          failedAttempts = 0;
          log("\nBLOKADA ZNIESIONA. MOÅ»NA KONTYNUOWAÄ†.");
          updateFirebase("UNLOCKED");
        }, 30000);
      }
    }
  }
});
</script>

</body>
</html>
